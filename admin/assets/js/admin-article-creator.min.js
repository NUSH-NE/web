const spinner=$("editorLoading");spinner.MDCCircularProgress.determinate=!1;const storageRef=firebase.storage().ref(),fPickerElem=$("fileUpload"),submitBtn=$("submitBtn"),db=firebase.firestore(),uploadProg=$("file-upload-progress").MDCLinearProgress;function initFUI(){fUIAuthDiv.textContent="";const e={callbacks:{signInSuccessWithAuthResult:function(e,t){return showHideUserArea(),!1},uiShown:function(){setTimeout(()=>{document.getElementById("loginLoader").style.display="none",loginSpinner.determinate=!0,mdc.autoInit()},50)}},signInFlow:"popup",signInOptions:[firebase.auth.GoogleAuthProvider.PROVIDER_ID,firebase.auth.EmailAuthProvider.PROVIDER_ID],tosUrl:"#",privacyPolicyUrl:"#"};fUI.start(fUIAuthDiv,e)}submitBtn.onclick=(()=>{if(0===fPickerElem.files.length)return void showMsg("No images selected");if(0===$("article-title").MDCTextField.value.length)return void showMsg("No article title");if(0===tinyMCE.activeEditor.getContent().length)return void showMsg("No article content");tinyMCE.activeEditor.getContent();const e=storageRef.child(fPickerElem.files[0].name).put(fPickerElem.files[0]);uploadProg.determinate=!1,submitBtn.disabled=!0,e.on("state_changed",e=>{uploadProg.determinate=!0,uploadProg.progress=e.bytesTransferred/e.totalBytes},e=>{console.error(e),submitBtn.disabled=!1},()=>{showMsg("Upload completed"),submitBtn.disabled=!1,e.snapshot.ref.getDownloadURL().then(e=>{db.collection("articles").add({content:tinyMCE.activeEditor.getContent(),link:e,resourceLink:$("resourceLink").value.split("\n").map(function(e){return e.trim()}),title:$("article-title").MDCTextField.value}).then(e=>{showMsg("Added article with ID "+e),fPickerElem.value="",$("article-title").MDCTextField.value="",$("resourceLink").value="",tinyMCE.activeEditor.setContent("")}).catch(e=>{showMsg("Error adding article: "+e)})})})}),$("uploadBtn").onclick=(()=>{$("fileUpload").click()}),fPickerElem.onchange=(e=>{q(".imgPreviews").innerHTML="",q(".imgPreviews").style.display=0!==fPickerElem.files.length?"grid":"none";const t=[];for(let e=0;e<fPickerElem.files.length;e++){const i=new FileReader;i.onload=(e=>{const t=document.createElement("img");t.classList.add("preview-img"),t.src=e.target.result.toString(),q(".imgPreviews").appendChild(t)}),i.readAsDataURL(fPickerElem.files[e]),t.push(fPickerElem.files[e].name)}$("uploadFName").textContent=0!==t.length?`Selected file(s): ${t.join(", ")}`:"No file(s) selected"}),tinymce.init({selector:"textarea#contentEditor",height:400,min_height:110,max_height:1e3,menubar:!1,browser_spellcheck:!0,contextmenu:!1,branding:!1,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount"],toolbar:"undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",help_tabs:["shortcuts","keyboardnav"],skin:"oxide-dark",content_style:"body { font-family:Roboto,Helvetica,Arial,sans-serif; font-size:14px }",content_css:"dark"}).then(()=>{console.log("Loaded"),spinner.style.display="none",spinner.MDCCircularProgress.determinate=!0,document.querySelectorAll(".tox .tox-tbtn").forEach(e=>{e.classList.add("mdc-ripple-surface"),e.setAttribute("data-mdc-auto-init","MDCRipple")}),mdc.autoInit()});