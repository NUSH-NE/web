const title=$("pgTitle"),usrAcctBtn=$("usrBtn"),loginDialog=$("loginDialog").MDCDialog,loginSpinner=q("#loginDialog #loginLoader > div").MDCCircularProgress,fUIAuthDiv=$("firebaseui-auth-container"),verifyEmailBtn=q("#verEmailMsg button"),readCardsHolder=$("read-cards"),elem=document.querySelector(".mason-cards"),readerDialog=$("readerDialog").MDCDialog;let fUI,maxHeight=250;function reCalcTitleAnim(){const t=(title.getBoundingClientRect().top-8)/maxHeight;if(scrollY>=maxHeight-8)return title.style.position="fixed",title.style.left="10px",title.style.top="10px",title.style.right="10px",title.style.zIndex="6",title.style.backgroundColor="rgba(0, 0, 0, 0.5)",title.style.borderRadius="7px",title.style.minWidth="unset",title.style.fontSize="1.75rem",void(title.style.lineHeight=title.style.fontSize);title.style.position="inherit",title.style.minWidth=`calc(${100*(1-t)}% - 20px)`,title.style.borderRadius=`${20*t+7}px`,title.style.fontSize=`${Math.min(3.75-2*(1-t),3.8)}rem`,title.style.lineHeight=title.style.fontSize,title.style.backgroundColor=`rgba(0, 0, 0, ${.5*(1-t)})`}function reCalcTotalHeight(){maxHeight=title.getBoundingClientRect().top+scrollY+15,reCalcTitleAnim()}function updateUsrInfo(t){q("#usrOps > h2").textContent=`Hello, ${t.displayName}`,q("#usrOps > img.profile-img").src=t.photoURL,$("usrName").textContent=`Name: ${t.displayName} `,$("usrEmail").textContent=`Email: ${t.email} `,$("verEmailMsg").style.display=t.emailVerified?"none":"block"}function showHideUserArea(){const t=$("usrOps");return cUser?(fUIAuthDiv.style.display="none",t.style.display="block",$("loginLoader").style.display="none",updateUsrInfo(cUser),!0):(fUIAuthDiv.style.display="block",t.style.display="none",$("loginLoader").style.display="block",loginSpinner.determinate=!1,!1)}function getArticleCard(t,e,i){const n=document.createElement("div");return n.classList.add("mdc-card"),n.innerHTML=`\n<div class="mdc-card__media mdc-card__media--16-9" style="background-image:url('${e}')">\n</div>\n<div class="mdc-card-wrapper__text-section">\n    <div class="mdc-card__text-section-header">${t.title}</div>\n    <div class="mdc-card__text-section-subhead">${t.articleContent}</div>\n</div>\n<div class="mdc-card__actions">\n    <div class="mdc-card__action-buttons">\n        <button class="mdc-button mdc-card__action mdc-card__action--button" data-mdc-auto-init="MDCRipple">\n            <div class="mdc-button__ripple"></div>\n            <span class="mdc-button__label">Read</span>\n        </button>\n    </div>\n    <div class="mdc-card__action-icons">\n        <button class="material-icons mdc-icon-button mdc-card__action mdc-card__action--icon mdc-ripple-surface" data-mdc-ripple-is-unbounded\n                title="Share" data-mdc-auto-init="MDCRipple">\n            share\n        </button>\n        <button class="material-icons mdc-icon-button mdc-card__action mdc-card__action--icon mdc-ripple-surface" data-mdc-ripple-is-unbounded\n                title="More options" data-mdc-auto-init="MDCRipple">\n            more_vert\n        </button>\n    </div>\n</div>\n    `,n.querySelector(".mdc-button.mdc-card__action.mdc-card__action--button").onclick=(()=>{i(t,e)}),n}function initFUI(){fUIAuthDiv.textContent="";const t={callbacks:{signInSuccessWithAuthResult:function(t,e){return showHideUserArea(),!1},uiShown:function(){setTimeout(()=>{document.getElementById("loginLoader").style.display="none",loginSpinner.determinate=!0,mdc.autoInit()},50)}},signInFlow:"popup",signInOptions:[firebase.auth.GoogleAuthProvider.PROVIDER_ID,firebase.auth.EmailAuthProvider.PROVIDER_ID],tosUrl:"#",privacyPolicyUrl:"#"};fUI.start(fUIAuthDiv,t)}function showAuthMsg(t){const e=$("authMsg"),i=q("#authMsg > div.mdc-card-wrapper__text-section");q("#authMsg button").onclick=(()=>e.classList.add("hidden")),i.textContent=t,e.classList.remove("hidden")}function showReaderDialog(t,e){const i=$("reader-content-holder");i.textContent="";const n=document.createElement("img");n.src=e,n.classList.add("readerHeadImg"),i.appendChild(n);const a=document.createElement("div");i.appendChild(a),a.innerHTML=t.articleContent,$("reader-title-elem").textContent=t.title,readerDialog.open()}let fAuth=firebase.auth(),cUser=null;document.addEventListener("scroll",()=>{setTimeout(()=>{reCalcTitleAnim()},30)},{passive:!0}),window.onresize=reCalcTotalHeight,new IntersectionObserver(()=>{usrAcctBtn.classList.toggle("hidden-fab")},{threshold:0}).observe($("b")),usrAcctBtn.onclick=(()=>{loginDialog.isOpen?loginDialog.close():(showHideUserArea()||initFUI(),loginDialog.open())}),$("signOutBtn").onclick=(()=>{fAuth.signOut().then(()=>{initFUI()},t=>{showMsg("Error signing out. Please try again later."),console.error(t)})}),verifyEmailBtn.onclick=(()=>{verifyEmailBtn.disabled=!0,cUser.sendEmailVerification().then(function(){showMsg(`Sent a verification email to ${cUser.email}`),showAuthMsg("Reopen this dialog after clicking on the verification link to check your email verification status")}).catch(function(t){showMsg(`Failed to send the verification email. Error: ${t.message}`)})}),fAuth.onAuthStateChanged(function(t){t?(cUser=t,showMsg(`Signed in as ${t.displayName}`),window.history.replaceState({},document.title,window.location.pathname)):(showMsg("You are signed out"),"select"===new URLSearchParams(window.location.search).get("mode")&&(loginDialog.open(),initFUI()),cUser=null),showHideUserArea()});const db=firebase.firestore();db.collection("articles").onSnapshot(t=>{readCardsHolder.textContent="",0===t.docs.length&&(readCardsHolder.innerHTML="<p>No articles</p>"),t.docs.forEach(t=>{readCardsHolder.appendChild(getArticleCard({articleContent:t.data().content,title:t.data().title},t.data().link,showReaderDialog))}),new Masonry(elem,{itemSelector:".mdc-card",fitWidth:!0,gutter:8}),mdc.autoInit()}),$("load-articles").MDCLinearProgress.determinate=!1,reCalcTotalHeight(),reCalcTitleAnim(),fUI=new firebaseui.auth.AuthUI(firebase.auth());