const title=$("pgTitle"),usrAcctBtn=$("usrBtn"),loginDialog=$("loginDialog").MDCDialog,loginSpinner=q("#loginDialog #loginLoader > div").MDCCircularProgress,fUIAuthDiv=$("firebaseui-auth-container"),verifyEmailBtn=q("#verEmailMsg button"),readCardsHolder=$("read-cards"),elem=document.querySelector(".mason-cards"),readerDialog=$("readerDialog").MDCDialog,readFixToggle=$("read-sidebar-fixed").MDCIconButtonToggle,readSidebar=q("div.reader-dialog aside.readerAside"),addPostBtn=$("addPostBtn"),fileUploadElem=$("fileUpload");let fUI,maxHeight=250;function reCalcTitleAnim(){const e=(title.getBoundingClientRect().top-8)/maxHeight;if(scrollY>=maxHeight-8)return title.style.position="fixed",title.style.left="10px",title.style.top="10px",title.style.right="10px",title.style.zIndex="6",title.style.backgroundColor="rgba(0, 0, 0, 0.5)",title.style.borderRadius="7px",title.style.minWidth="unset",title.style.fontSize="1.75rem",void(title.style.lineHeight=title.style.fontSize);title.style.position="inherit",title.style.minWidth=`calc(${100*(1-e)}% - 20px)`,title.style.borderRadius=`${20*e+7}px`,title.style.fontSize=`${Math.min(3.75-2*(1-e),3.8)}rem`,title.style.lineHeight=title.style.fontSize,title.style.backgroundColor=`rgba(0, 0, 0, ${.5*(1-e)})`}function reCalcTotalHeight(){maxHeight=title.getBoundingClientRect().top+scrollY+15,reCalcTitleAnim()}function updateUsrInfo(e){q("#usrOps > h2").textContent=`Hello, ${e.displayName}`,q("#usrOps > img.profile-img").src=e.photoURL,$("usrName").textContent=`Name: ${e.displayName} `,$("usrEmail").textContent=`Email: ${e.email} `,$("verEmailMsg").style.display=e.emailVerified?"none":"block"}function showHideUserArea(){const e=$("usrOps");return cUser?(fUIAuthDiv.style.display="none",e.style.display="block",$("loginLoader").style.display="none",updateUsrInfo(cUser),!0):(fUIAuthDiv.style.display="block",e.style.display="none",$("loginLoader").style.display="block",loginSpinner.determinate=!1,!1)}function getArticleCard(e,t,i){const n=document.createElement("div");return n.classList.add("mdc-card"),n.innerHTML=`\n<div class="mdc-card__media mdc-card__media--16-9" style="background-image:url('${t}')">\n</div>\n<div class="mdc-card-wrapper__text-section">\n    <div class="mdc-card__text-section-header">${e.title}</div>\n    <div class="mdc-card__text-section-subhead">${e.articleContent}</div>\n</div>\n<div class="mdc-card__actions">\n    <div class="mdc-card__action-buttons">\n        <button class="mdc-button mdc-card__action mdc-card__action--button" data-mdc-auto-init="MDCRipple">\n            <div class="mdc-button__ripple"></div>\n            <span class="mdc-button__label">Read</span>\n        </button>\n    </div>\n    <div class="mdc-card__action-icons">\n        <button class="material-icons mdc-icon-button mdc-card__action mdc-card__action--icon mdc-ripple-surface" data-mdc-ripple-is-unbounded\n                title="Share" data-mdc-auto-init="MDCRipple">\n            share\n        </button>\n        <button class="material-icons mdc-icon-button mdc-card__action mdc-card__action--icon mdc-ripple-surface" data-mdc-ripple-is-unbounded\n                title="More options" data-mdc-auto-init="MDCRipple">\n            more_vert\n        </button>\n    </div>\n</div>\n    `,n.querySelector(".mdc-button.mdc-card__action.mdc-card__action--button").onclick=(()=>{i(e,t)}),n}function initFUI(){fUIAuthDiv.textContent="";const e={callbacks:{signInSuccessWithAuthResult:function(e,t){return showHideUserArea(),!1},uiShown:function(){setTimeout(()=>{document.getElementById("loginLoader").style.display="none",loginSpinner.determinate=!0,mdc.autoInit()},50)}},signInFlow:"popup",signInOptions:[firebase.auth.GoogleAuthProvider.PROVIDER_ID,firebase.auth.EmailAuthProvider.PROVIDER_ID],tosUrl:"#",privacyPolicyUrl:"#"};fUI.start(fUIAuthDiv,e)}function showAuthMsg(e){const t=$("authMsg"),i=q("#authMsg > div.mdc-card-wrapper__text-section");q("#authMsg button").onclick=(()=>t.classList.add("hidden")),i.textContent=e,t.classList.remove("hidden")}function showReaderDialog(e,t){const i=$("reader-content-holder"),n=$("readerResLinks");i.textContent="",n.textContent="";const a=document.createElement("img");a.src=t,a.classList.add("readerHeadImg"),i.appendChild(a);const l=document.createElement("div");i.appendChild(l),l.innerHTML=e.articleContent,$("reader-title-elem").textContent=e.title,e.resLinks?e.resLinks.forEach(e=>{const t=document.createElement("li"),i=document.createElement("a");i.textContent=e.length<=50?e:e.slice(50)+"...",i.href=e,t.appendChild(i),n.appendChild(t)}):n.innerHTML+="<p>No resource links</p>",readerDialog.open()}let fAuth=firebase.auth(),cUser=null;document.addEventListener("scroll",()=>{setTimeout(()=>{reCalcTitleAnim()},30)},{passive:!0}),window.onresize=reCalcTotalHeight,new IntersectionObserver(()=>{usrAcctBtn.classList.toggle("hidden-fab")},{threshold:0}).observe($("b")),usrAcctBtn.onclick=(()=>{loginDialog.isOpen?loginDialog.close():(showHideUserArea()||initFUI(),loginDialog.open())}),$("signOutBtn").onclick=(()=>{fAuth.signOut().then(()=>{initFUI()},e=>{showMsg("Error signing out. Please try again later."),console.error(e)})}),verifyEmailBtn.onclick=(()=>{verifyEmailBtn.disabled=!0,cUser.sendEmailVerification().then(function(){showMsg(`Sent a verification email to ${cUser.email}`),showAuthMsg("Reopen this dialog after clicking on the verification link to check your email verification status")}).catch(function(e){showMsg(`Failed to send the verification email. Error: ${e.message}`)})}),fAuth.onAuthStateChanged(function(e){e?(cUser=e,showMsg(`Signed in as ${e.displayName}`),window.history.replaceState({},document.title,window.location.pathname)):(showMsg("You are signed out"),"select"===new URLSearchParams(window.location.search).get("mode")&&(loginDialog.open(),initFUI()),cUser=null),showHideUserArea()});const db=firebase.firestore();db.collection("articles").onSnapshot(e=>{readCardsHolder.textContent="",0===e.docs.length&&(readCardsHolder.innerHTML="<p>No articles</p>"),e.docs.forEach(e=>{readCardsHolder.appendChild(getArticleCard({articleContent:e.data().content,title:e.data().title,resLinks:e.data().resourceLink},e.data().link,showReaderDialog))}),new Masonry(elem,{itemSelector:".mdc-card",fitWidth:!0,gutter:8}),mdc.autoInit()}),readFixToggle.listen("MDCIconButtonToggle:change",e=>{e.detail.isOn?readSidebar.classList.add("fixed"):readSidebar.classList.remove("fixed")}),addPostBtn.onclick=(()=>{fileUploadElem.click()}),fileUploadElem.onchange=(()=>{const e=new FileReader;e.onload=(e=>{q(".post-dialog img.img-preview").src=e.target.result.toString()}),e.readAsDataURL(fileUploadElem.files[0]),$("postImgDialog").MDCDialog.open()});const flkty=new Flickity("#postCarousel",{wrapAround:!0,lazyLoad:4,pageDots:!1,arrowShape:"M 69.25 12.457031 C 67.207031 10.417969 63.917969 10.417969 61.875 12.457031 L 27.25 47.082031 C 25.625 48.707031 25.625 51.332031 27.25 52.957031 L 61.875 87.582031 C 63.917969 89.625 67.207031 89.625 69.25 87.582031 C 71.292969 85.542969 71.292969 82.25 69.25 80.207031 L 39.082031 50 L 69.292969 19.792969 C 71.292969 17.792969 71.292969 14.457031 69.25 12.457031 Z M 69.25 12.457031"});for(let e=0;e<100;e++){const t=document.createElement("div");t.innerHTML=`<img data-flickity-lazyload="https://picsum.photos/1600/900.webp?random=${e}" class="mdc-elevation--z16"/>`,t.classList.add("carousel-cell"),q("#postCarousel .flickity-slider").appendChild(t)}function reload(){q("#postCarousel .flickity-slider").textContent="";for(let e=0;e<100;e++){const t=document.createElement("div");t.innerHTML=`<img data-flickity-lazyload="https://picsum.photos/1600/900.webp?random=${e}" class="mdc-elevation--z16"/>`,t.classList.add("carousel-cell"),q("#postCarousel .flickity-slider").appendChild(t)}flkty.reloadCells(),flkty.next(),flkty.previous()}flkty.reloadCells(),flkty.next(),flkty.previous(),flkty.nextButton.element.classList.add("mdc-ripple-surface","mdc-elevation--z20"),flkty.nextButton.element.setAttribute("data-mdc-auto-init","MDCRipple"),flkty.prevButton.element.classList.add("mdc-ripple-surface","mdc-elevation--z20"),flkty.prevButton.element.setAttribute("data-mdc-auto-init","MDCRipple"),$("load-articles").MDCLinearProgress.determinate=!1,reCalcTotalHeight(),reCalcTitleAnim(),fUI=new firebaseui.auth.AuthUI(firebase.auth());