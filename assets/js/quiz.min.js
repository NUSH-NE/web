class timer{constructor(t,e){this.intID=null,this.cb=e,this.progress=t.MDCLinearProgress}initTimer(t){this.totalTime=t,this.current=t,null!==this.intID&&(clearInterval(this.intID),this.intID=null)}startTimer(){return!(this.current<0)&&(this.progress.progress=1,this.cb((this.totalTime/1e3).toFixed(0)),this.st=new Date,setTimeout(()=>{this.intID=setInterval(()=>{this.progress.progress=this.current/this.totalTime,this.cb((this.current/1e3).toFixed(0)),this.current=this.totalTime-(new Date-this.st),this.current<0&&(clearInterval(this.intID),this.intID=null,this.progress.progress=0,this.cb(0))},100)},250),!0)}pauseTimer(){clearInterval(this.intID),this.intID=null}}class pointsCalc{constructor(t){this.maxTime=t}mainStart(){this.stats={quizStart:new Date,quizEnd:null,quizTime:null},this.history={}}start(t){this.history[t]={startTime:new Date,endTime:null,tTime:null,res:0,pts:0}}end(t,e){this.history[t].endTime=new Date,this.history[t].tTime=this.history[t].endTime-this.history[t].startTime,this.history[t].res=e,this.history[t].pts=2===e?0:e?10*(.5*Math.pow(10-this.history[t].tTime*(1e4/this.maxTime)/1e3,2)+2):20}mainEnd(){this.stats.quizEnd=new Date,this.stats.quizTime=this.stats.quizEnd-this.stats.quizStart}getHistory(){return this.history}getTotPts(){let t=0;for(const e in this.history)this.history.hasOwnProperty(e)&&(t+=Math.round(this.history[e].pts));return t}}(()=>{const t=firebase.firestore(),e=$("result-dialog").MDCDialog,i=$("end-dialog").MDCDialog,s=$("dialog-pts-odometer"),n=$("scrim"),o=q("#scrimTimer > span"),r=$("scrimTimer"),a=t=>Math.floor(Math.random()*t),h=new timer($("timer-progress"),t=>{$("timer-number").textContent=t,0===t&&p(10)}),l=new pointsCalc(1e4);let d=[];const c=[],u=()=>{let t=5e3,e=0;o.textContent=(t/1e3).toFixed(0),r.style.setProperty("--shape-rotation",`${45*e}deg`),n.classList.remove("hidden"),$("scrimQn").textContent=d[c[0]].qn;const i=setInterval(()=>{o.textContent=(t/1e3).toFixed(0),t-=100,r.style.setProperty("--shape-rotation",`${45*e}deg`),t%500==0&&e++,t<0&&(n.classList.add("hidden"),clearInterval(i),h.initTimer(1e4),h.startTimer(),l.start(c[0]),q("button.quiz-opt__1 > span.mdc-typography--body1").textContent=d[c[0]].op1,q("button.quiz-opt__2 > span.mdc-typography--body1").textContent=d[c[0]].op2,q("button.quiz-opt__3 > span.mdc-typography--body1").textContent=d[c[0]].op3,q("button.quiz-opt__4 > span.mdc-typography--body1").textContent=d[c[0]].op4,$("question-text").textContent=d[c[0]].qn,$("num-qns").textContent=c.length)},100)},m=()=>{if(c.splice(0,1),c.length<=0)return $("end-dialog-content").textContent=`You have reached the end of the quiz, and scored ${l.getTotPts()} points! Congrats!`,$("endAnim").play(),void i.open();u()},p=t=>{if(h.pauseTimer(),0===c.length)return;const i=t>4?2:t===d[c[0]].cOp?1:0;l.end(c[0],i),showMsg(2===i?"Out of time!":i?"Correct!":"Wrong!"),((t,i=!1)=>{$("resultAnim").load(t?"assets/raw/check.json":"assets/raw/cross.json"),q("#res-dialog-title > h2").textContent=i?"You ran out of time!":t?"Correct!":"Wrong!",$("res-dialog-content").textContent=i?"Try to be faster next time! You can do it!":t?"Congratulations! Keep up the good work!":"Whoops! Try harder next time. You can do it!",s.textContent="0",s.textContent=l.getHistory()[c[0]].pts.toFixed(0),e.open(),$("totPts").textContent=l.getTotPts()})(1===i,2===i),$("main-anim").pause()};e.listen("MDCDialog:closed",()=>{m(),c.length>0&&$("main-anim").play()}),q("button.quiz-opt__1").onclick=(()=>p(1)),q("button.quiz-opt__2").onclick=(()=>p(2)),q("button.quiz-opt__3").onclick=(()=>p(3)),q("button.quiz-opt__4").onclick=(()=>p(4)),i.scrimClickAction="",i.escapeKeyAction="";const g=$("dQuizAnim"),y=new URLSearchParams(window.location.search).get("id"),C=()=>{g.load("assets/raw/error.json"),g.loop=!1};if(!y)return C(),$("dQuizHeader").textContent="No quiz ID specified",void($("dQuizOverline").textContent="Go to the quiz page and click on the link that led you here again");t.collection("quiz").doc(y).get().then(t=>{if(t.exists){d=t.data().qns;const e=$("scrimLoader"),i=$("scrimContent"),s=400;e.classList.add("fader","faded"),i.classList.add("fader","faded"),setTimeout(()=>{e.remove(),i.classList.remove("display-none"),setTimeout(()=>i.classList.remove("faded"),10),setTimeout(()=>(()=>{for(let t=0;t<d.length;t++){let t=a(d.length);do{t=a(d.length)}while(c.includes(t));c.push(t)}l.mainStart(),u()})(),s/5)},s)}else C(),$("dQuizHeader").textContent="The quiz with the specified ID could not be downloaded",$("dQuizOverline").textContent="Go to the quiz page and click on the link that led you here again"}).catch(t=>{C(),$("dQuizHeader").textContent="Error downloading quiz",$("dQuizOverline").textContent="Refresh this page to try again",console.error(t)})})();